# CCTDI批判性思维评估系统

[![Python Version](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-Apache%202.0-green.svg)](LICENSE)

## 📖 项目简介

这是一个基于**四智能体协作架构**的CCTDI（California Critical Thinking Disposition Inventory，加利福尼亚批判性思维倾向量表）自动化评估系统。

**核心创新**：将传统的70道题问卷式评估转化为**智能化自然对话评估**，通过AI驱动的多智能体协作，实现更加人性化、情境化的批判性思维能力测评。

### ✨ 主要特点

- 🤖 **四智能体协作**：导演、导航、诊断、评分四个AI智能体分工协作
- 💬 **自然对话评估**：摆脱传统问卷，通过对话深入了解思维模式
- 🎯 **自适应交互**：根据用户回答质量动态调整提问策略（鼓励/正常/追问）
- 🔍 **智能诊断**：自动判断信息充足性，优化评估效率（3-5轮交互）
- 📊 **精细评分**：每维度10-60分，总分420分，精确到个位数
- 🧪 **虚拟用户测试**：支持批量自动化测试，验证系统稳定性
- 📁 **完整数据记录**：CSV对话记录 + JSON评估报告 + 评分汇总

---

## 🎯 评估维度

系统评估**7个批判性思维核心维度**（基于CCTDI量表）：

| 维度ID | 维度名称 | 题目范围 | 分数范围 | 能力描述 |
|--------|----------|----------|----------|----------|
| 1 | 寻找真理 | 1-10题 | 10-60分 | 寻求真理和准确信息的倾向 |
| 2 | 开放思想 | 11-20题 | 10-60分 | 对不同观点和想法的开放程度 |
| 3 | 分析能力 | 21-30题 | 10-60分 | 分析和评估信息的能力 |
| 4 | 系统化能力 | 31-40题 | 10-60分 | 系统性思考和解决问题的能力 |
| 5 | 批判性思维自信 | 41-50题 | 10-60分 | 对自己批判性思维能力的信心 |
| 6 | 求知欲 | 51-60题 | 10-60分 | 对学习和探索新知识的渴望 |
| 7 | 认知成熟度 | 61-70题 | 10-60分 | 在复杂情况下做出成熟判断的能力 |

**总分**：420分（满分），平均值基准：245分（35分×7）

### 评级标准

- **优秀**：350-420分（平均50分/维度）
- **良好**：280-349分（平均40-49分/维度）
- **一般**：210-279分（平均30-39分/维度）
- **较差**：140-209分（平均20-29分/维度）
- **极差**：70-139分（平均10-19分/维度）

---

## 🏗️ 系统架构

### 四智能体协作模型

```
┌─────────────────────────────────────────────────────────────┐
│                    CCTDI评估系统流程                          │
└─────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────┐
    │  1️⃣ 情景化导演Agent (ScenarioDirectorAgent)      │
    │  • 系统总控制器                                   │
    │  • 管理7个维度的推进                              │
    │  • 生成维度指导信息                               │
    └──────────────┬───────────────────────────────────┘
                   │
                   ▼
    ┌──────────────────────────────────────────────────┐
    │  2️⃣ 自适应导航Agent (AdaptiveNavigatorAgent)     │
    │  • 用户交互专家                                   │
    │  • 三种模式: 鼓励/正常/追问                       │
    │  • 生成针对性问题                                 │
    └──────────────┬───────────────────────────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │   用户回答       │
         │  (真实/虚拟)     │
         └─────────┬───────┘
                   │
                   ▼
    ┌──────────────────────────────────────────────────┐
    │  3️⃣ 诊断Agent (DiagnosticAgent)                  │
    │  • 判断信息充足性                                 │
    │  • 3-5轮智能控制                                  │
    │  • 继续 or 评分                                   │
    └──────────────┬───────────────────────────────────┘
                   │
                   ▼
    ┌──────────────────────────────────────────────────┐
    │  4️⃣ 评分Agent (ScoringAgent)                     │
    │  • 精细评分 (10-60分)                            │
    │  • 35分平均值基准                                 │
    │  • 生成详细评价报告                               │
    └──────────────┬───────────────────────────────────┘
                   │
                   ▼
           ┌───────────────┐
           │ 维度完成?      │
           └───┬───────┬───┘
              否│      │是
                │      └──> 下一维度 (返回步骤1)
                │
                ▼
        ┌─────────────────┐
        │  生成最终报告    │
        │  • CSV对话记录   │
        │  • JSON评估报告  │
        │  • 评分汇总      │
        └─────────────────┘
```

---

## 📁 项目结构

```
MASA-CCTDI/
├── README.md                      # 项目说明文档
├── LICENSE                        # Apache 2.0许可证
├── CONTRIBUTING.md                # 贡献指南
├── CHANGELOG.md                   # 版本更新日志
├── requirements.txt               # Python依赖包
├── .env.example                   # 环境变量配置示例
├── .gitignore                     # Git忽略规则
│
├── 📜 核心代码
│   ├── cctdi_system.py            # 主系统控制器 & CLI界面
│   ├── cctdi_agents.py            # 四智能体实现
│   ├── web_app.py                 # Web界面版本（Streamlit）
│   └── auto_simu_concurrent.py    # 虚拟用户并发测试版本
│
├── 📂 提示词与量表
│   └── prompts/
│       └── CCTDI.txt              # 原版CCTDI量表（70题，6点Likert）
│
├── 👥 虚拟用户画像
│   └── persons/
│       ├── 1张伟.txt
│       ├── 2李晓梅.txt
│       ├── 3柳建国.txt
│       ├── 4陈思远.txt
│       └── 5李小南.txt
│
└── 📊 数据输出（运行时生成）
    └── data/
        ├── conversations/         # CSV对话记录
        ├── assessments/           # JSON评估报告
        └── user_scores.csv        # 用户评分汇总表
```

---

## 🚀 快速开始

### 环境要求

- **Python**: 3.11+
- **操作系统**: Windows / macOS / Linux
- **依赖库**: 见 `requirements.txt`

### 1. 克隆仓库

```bash
git clone https://github.com/zecoon/MASA-CCTDI.git
cd MASA-CCTDI
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 配置API密钥

```bash
# 复制示例配置文件
cp .env.example .env

# 编辑 .env 文件，填写您的API密钥
# OPENAI_API_KEY=sk-your-api-key-here
# OPENAI_BASE_URL=https://api.openai.com/v1
# OPENAI_MODEL=gpt-4o
```

### 4. 选择运行方式

本系统提供**三种运行方式**，适应不同使用场景：

---

#### 🖥️ 方式一：CLI命令行版本

**适用场景**：单用户实时评估，适合研究人员和个人使用

**启动命令**：
```bash
python cctdi_system.py cli
```

**特点**：
- 交互式命令行界面
- 实时对话评估
- 支持7个维度完整评估
- 自动保存对话记录和评估报告
- 输入 `exit` 或 `退出` 可随时结束

**运行流程**：
1. 输入用户信息（编号、姓名）
2. 系统逐个维度进行对话（共7个维度）
3. 每个维度3-5轮自适应交互
4. 自动生成CSV对话记录和JSON评估报告

---

#### 🌐 方式二：Web界面版本

**适用场景**：多用户在线评估，适合教育机构和企业使用

**启动命令**：
```bash
streamlit run web_app.py
```

**特点**：
- 现代化Web界面
- 支持多用户并发访问
- 实时进度追踪和可视化
- 在线下载评估报告
- 响应式设计，支持移动端

**访问方式**：
启动后自动打开浏览器，访问 `http://localhost:8501`

**使用流程**：
1. 输入用户信息
2. 点击"开始评估"
3. 实时对话交互（进度条显示）
4. 评估完成后下载JSON报告

---

#### ⚡ 方式三：虚拟用户并发测试版本

**适用场景**：系统测试和性能验证，适合开发者和研究者

**启动命令**：

**单个虚拟用户测试：**
```bash
python auto_simu_concurrent.py persons/1张伟.txt
```

**批量并发测试（默认3线程）：**
```bash
python auto_simu_concurrent.py
```

**自定义并发线程数：**
```bash
python auto_simu_concurrent.py --workers 5
```

**特点**：
- 基于ThreadPoolExecutor的多线程并发
- 虚拟用户基于LLM自动生成回答
- 线程安全的文件写入
- 实时进度追踪和统计
- 批量测试效率提升3-5倍

**虚拟用户画像格式**：
每个画像文件（.txt）应包含：
- 基础信息（姓名、性别、年龄、职业）
- 成长与背景
- 个人特质与生活方式
- 思维与认知特征

---

## 📊 数据输出说明

### 1. CSV对话记录 (`data/conversations/{编号姓名}_对话.csv`)

记录完整的对话过程：

| 字段 | 说明 |
|------|------|
| 会话ID | 编号+姓名（如"1张伟"） |
| 维度编号 | 1-7 |
| 维度名称 | 如"寻找真理" |
| 对话轮次 | 当前维度的第几轮交互 |
| 时间戳 | 精确到秒 |
| 角色 | 系统/用户 |
| 交互模式 | 鼓励/正常/追问/评分/总结 |
| 内容 | 问题或回答内容 |
| 状态 | 进行中/已完成 |

### 2. JSON评估报告 (`data/assessments/{编号姓名}_证据_思维.json`)

详细的评估结果：

```json
{
  "status": "completed",
  "session_id": "1张伟",
  "completion_time": "2024-10-11T23:16:45.123456",
  "total_score": 371,
  "average_score": 53.0,
  "overall_level": "优秀",
  "dimension_scores": {
    "1": {
      "score": 54,
      "level": "优秀",
      "reasoning": "详细评分理由",
      "evidence": ["证据1", "证据2", ...],
      "strengths": ["优势1", "优势2", ...],
      "weaknesses": ["不足1", "不足2", ...]
    },
    ...
  }
}
```

### 3. 用户评分汇总 (`data/user_scores.csv`)

所有用户的评分汇总表：

| 编号 | 姓名 | 维度1 | 维度2 | 维度3 | 维度4 | 维度5 | 维度6 | 维度7 | 总分 |
|------|------|-------|-------|-------|-------|-------|-------|-------|------|
| 1 | 张伟 | 54 | 48 | 51 | 54 | 54 | 55 | 55 | 371 |
| 4 | 陈思远 | 56 | 54 | 54 | 54 | 55 | 56 | 53 | 382 |

---

## 🧪 虚拟用户测试系统

### 虚拟用户画像格式

每个画像文件包含：
- 基础信息（姓名、性别、年龄、职业）
- 成长与背景（家庭、教育、关键经历）
- 个人特质与生活方式（性格、价值观、兴趣）
- **思维与认知特征**（批判性思维等级、决策风格、认知偏见）

### 已完成测试结果

| 排名 | 编号 | 姓名 | 总分 | 评级 |
|------|------|------|------|------|
| 🥇 | 4 | 陈思远 | 382 | 优秀 |
| 🥈 | 5 | 李小南 | 372 | 优秀 |
| 🥉 | 1 | 张伟 | 371 | 优秀 |
| 4 | 6 | 李明轩 | 353 | 优秀 |
| 5 | 10 | 高明华 | 346 | 良好 |
| 6 | 9 | 贾桂英 | 335 | 良好 |
| 7 | 2 | 李晓梅 | 326 | 良好 |
| 8 | 3 | 柳建国 | 326 | 良好 |
| 9 | 7 | 赵丽美 | 319 | 良好 |
| 10 | 8 | 程雪莲 | 309 | 一般 |

**统计数据**：
- 平均分：343.9 / 420
- 平均维度分：49.1 / 60
- 优秀率：40%（4/10）
- 良好率：50%（5/10）

---

## 🔧 技术实现细节

### 核心类说明

#### 1. `CCTDIAssessmentSystem` (主系统)

**职责**：系统总控制器

```python
system = CCTDIAssessmentSystem(user_id="1", user_name="张伟")
result = system.start_assessment()  # 开始评估
response = system.process_user_response("用户回答")  # 处理回答
```

**关键方法**：
- `start_assessment()`: 启动评估
- `process_user_response(user_input)`: 处理用户输入
- `get_system_status()`: 获取系统状态
- `force_score_current_dimension()`: 强制评分（测试用）

#### 2. `ConversationCSVManager` (对话管理)

**职责**：CSV对话记录管理

```python
csv_manager.save_question(...)      # 保存问题
csv_manager.save_user_response(...) # 保存回答
csv_manager.save_dimension_score(...) # 保存评分
```

#### 3. `BaseAgent` (智能体基类)

**职责**：LLM调用封装

- `_call_llm()`: 调用大语言模型（支持重试）
- `_clean_json_response()`: 清理JSON响应

#### 4. 四个智能体类

- `ScenarioDirectorAgent`: 导演Agent
- `AdaptiveNavigatorAgent`: 导航Agent
- `DiagnosticAgent`: 诊断Agent
- `ScoringAgent`: 评分Agent

### 评分机制

**评分标准（10-60分，35分为平均值）**：

| 分数段 | 评级 | 描述 |
|--------|------|------|
| 51-60 | 优秀 | 持续表现高质量思维，洞察力强 |
| 41-50 | 良好 | 经常表现出相关思维特征，较为出色 |
| 31-40 | 一般 | 基本的相关思维表现，35分为标准平均值 |
| 21-30 | 较差 | 能力明显不足，很少表现出相关思维 |
| 10-20 | 极差 | 完全缺乏该维度能力，几乎无相关表现 |

**校准机制**：
- 虚拟用户回答可能显得完美，需系统性向下调整8-10分
- 目标：大部分用户得分落在30-40分区间
- 50+分必须极其罕见

### 自适应交互模式

| 模式 | 触发条件 | 策略 |
|------|----------|------|
| **鼓励** | 回答<20字 或 包含"不知道"等消极词汇 | 提供支持和引导，降低难度 |
| **正常** | 回答20-100字，标准回应 | 自然对话，继续探索 |
| **追问** | 回答>100字，详细深入 | 深入挖掘思考过程，要求具体例子 |

---

## 📈 使用场景

### 1. 教育评估
- 学生批判性思维能力诊断
- 教学效果评估
- 个性化学习建议

### 2. 人才选拔
- 招聘面试辅助评估
- 员工思维能力分析
- 培训需求识别

### 3. 科研应用
- 批判性思维量表研究
- AI评估系统研究
- 认知心理学研究

### 4. 自我提升
- 个人思维能力诊断
- 成长路径规划
- 定期进度追踪

---

## ⚙️ 配置说明

### 环境变量 (`.env`)

```env
# OpenAI API配置（支持兼容接口）
OPENAI_API_KEY=sk-xxxxxxxxxxxxx           # API密钥
OPENAI_BASE_URL=https://api.openai.com/v1 # API地址
OPENAI_MODEL=gpt-4o                       # 模型名称

# 兼容旧版变量
ARK_API_KEY=sk-xxxxxxxxxxxxx
```

### 系统参数调整

**文件**: `new_cctdi_agents.py`

```python
# LLM调用参数
temperature=0.7      # 创造性（0-1）
max_tokens=800       # 最大输出长度
max_retries=3        # 失败重试次数

# 交互轮次控制
min_rounds = 3       # 最少交互轮次
max_rounds = 5       # 最多交互轮次（强制评分）
```

---

## 🐛 故障排除

### 常见问题

**Q1: 提示 API 调用失败？**
```
检查 .env 文件中的 API 配置是否正确
确保 API 余额充足
检查网络连接
```

**Q2: JSON解析失败？**
```
系统已内置重试机制和默认值
如频繁发生，可能是模型输出格式问题
建议更换为 gpt-4o 或更高版本模型
```

**Q3: 虚拟用户测试速度慢？**
```
每个用户完整评估需调用约30-50次LLM
建议使用批量测试模式，避免频繁启动
可调整 max_rounds 减少交互轮次
```

**Q4: 评分过高或过低？**
```
检查 ScoringAgent 中的评分标准
调整校准提示词中的"向下调整8-10分"参数
使用真实用户数据进行校准
```

---

## 🛣️ 开发路线图

### 当前版本: v1.0

- ✅ 四智能体架构实现
- ✅ 自适应交互模式
- ✅ 智能诊断机制
- ✅ 精细评分系统
- ✅ 虚拟用户测试
- ✅ 数据记录与导出

### 计划功能 (v2.0)

- 🔲 Web UI界面（Flask/Streamlit）
- 🔲 多语言支持（英文、日文等）
- 🔲 实时评分可视化
- 🔲 历史数据对比分析
- 🔲 自定义评估维度
- 🔲 语音交互支持
- 🔲 移动端APP

### 长期规划

- 多模态评估（图像、视频）
- 群体评估模式
- 教师/HR管理后台
- 数据分析与报告生成
- 云服务部署

---

## 📚 参考文献

1. **CCTDI量表**:
   - Facione, P. A., Facione, N. C., & Giancarlo, C. A. (1998). The California Critical Thinking Disposition Inventory (CCTDI).

2. **批判性思维研究**:
   - Ennis, R. H. (1996). Critical thinking dispositions: Their nature and assessability.
   - Paul, R., & Elder, L. (2006). Critical thinking: The nature of critical and creative thought.

3. **CCTDI中文版**:
   - 彭美慈等 (2004). 批判性思维能力测量表的信效度测试研究.

---

## 📖 引用本项目

如果您在研究中使用了本项目，请引用我们的论文：

### 论文信息

**[待补充 - 请提供论文详细信息]**

```
标题: MASA: Multi-Agent Guided Interview for Scenario-Based Assessment of Critical Thinking
作者: [待补充]
会议/期刊: [待补充]
年份: [待补充]
DOI: [待补充]
```

### BibTeX引用

```bibtex
@inproceedings{masa2024,
  title={MASA: Multi-Agent Guided Interview for Scenario-Based Assessment of Critical Thinking},
  author={[待补充]},
  booktitle={[待补充]},
  year={2024},
  organization={[待补充]}
}
```

### APA格式

```
[待补充]. (2024). MASA: Multi-Agent Guided Interview for Scenario-Based Assessment of Critical Thinking. [待补充].
```

---

## 🤝 贡献指南

欢迎贡献代码、报告问题或提出建议！

详细的贡献指南请查看 [CONTRIBUTING.md](CONTRIBUTING.md)

**快速开始**：
1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改（遵循提交规范）
4. 推送到分支并开启 Pull Request

**代码规范**：遵循 PEP 8，使用类型注解，添加必要注释

---

## 📄 许可证

本项目采用 Apache License 2.0 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 👨‍💻 作者与联系

**项目维护者**: MASA-CCTDI 开发团队

**论文作者**: [待补充 - 论文作者列表]

- 💼 GitHub: [MASA-CCTDI](https://github.com/zecoon/MASA-CCTDI)
- 📝 Issues: [提交问题](https://github.com/zecoon/MASA-CCTDI/issues)
- 💬 Discussions: [参与讨论](https://github.com/zecoon/MASA-CCTDI/discussions)

---

## 🙏 致谢

- 感谢 OpenAI 提供强大的语言模型
- 感谢 CCTDI 量表开发团队
- 感谢所有测试用户的反馈

---

## 📊 项目统计

- **代码行数**: ~1,500 行
- **测试覆盖**: 10个虚拟用户画像
- **平均评估时长**: 2-5分钟/用户
- **系统稳定性**: 99%+

---

**最后更新**: 2024年10月12日

**版本**: v1.0.0

---

## 🎯 快速链接

- [安装指南](#-快速开始)
- [使用文档](#-数据输出说明)
- [API文档](#-技术实现细节)
- [常见问题](#-故障排除)
- [更新日志](CHANGELOG.md)

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请给我们一个 Star！⭐**

</div>
